<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D iPhone 17 Pro Max (Three.js)</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #f0f0f0; } /* Нейтральный фон */
        canvas { display: block; }
    </style>
</head>
<body>
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.165.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.165.0/examples/jsm/"
            }
        }
    </script>
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // --- КОНСТАНТЫ ДИЗАЙНА ---
        const IP_WIDTH = 1.6;
        const IP_HEIGHT = 3.3;
        const IP_DEPTH = 0.17;
        const ORANGE_COLOR = 0xFF6600; // Морковный / Cosmic Orange
        const SCREEN_BEZEL_THICKNESS = 0.05;

        // ВНИМАНИЕ: Замените эту ссылку на прямую ссылку (URL) к вашему скриншоту из "Мира Танков"!
        const SCREEN_TEXTURE_URL = 'https://picsum.photos/400/820?random=1'; // Используется заглушка, замените на скриншот WOT

        // Инициализация сцены
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f0f0); // Нейтральный фон

        // Инициализация камеры
        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 0.5, 5);

        // Инициализация рендерера
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;

        // --- Элементы освещения ---

        // Направленный свет для глянца и теней
        const directionalLight = new THREE.DirectionalLight(0xffffff, 3.5);
        directionalLight.position.set(5, 10, 7.5);
        directionalLight.castShadow = true;
        directionalLight.shadow.mapSize.width = 2048;
        directionalLight.shadow.mapSize.height = 2048;
        directionalLight.shadow.camera.left = -5;
        directionalLight.shadow.camera.right = 5;
        directionalLight.shadow.camera.top = 5;
        directionalLight.shadow.camera.bottom = -5;
        scene.add(directionalLight);

        // Мягкий рассеянный свет
        const ambientLight = new THREE.AmbientLight(0x404040, 1.8);
        scene.add(ambientLight);

        // --- СОЗДАНИЕ МОДЕЛИ IPHONE 17 PRO MAX ---

        // 1. Корпус (задняя панель + боковины)
        const backMaterial = new THREE.MeshPhysicalMaterial({
            color: new THREE.Color(ORANGE_COLOR),
            metalness: 0.9, // Металлическая рамка
            roughness: 0.1, // Глянец стекла / полированного металла
            clearcoat: 1.0, // Высокий глянец
            clearcoatRoughness: 0.05
        });

        // Основной корпус
        const bodyGeometry = new THREE.BoxGeometry(IP_WIDTH, IP_HEIGHT, IP_DEPTH);
        const iphoneBody = new THREE.Mesh(bodyGeometry, backMaterial);
        iphoneBody.castShadow = true;
        iphoneBody.receiveShadow = true;

        // 2. Экран (само изображение)
        const loader = new THREE.TextureLoader();
        const screenTexture = loader.load(SCREEN_TEXTURE_URL);
        screenTexture.colorSpace = THREE.SRGBColorSpace; // Цветовое пространство

        const screenMaterial = new THREE.MeshBasicMaterial({ map: screenTexture });
        const screenGeometry = new THREE.PlaneGeometry(
            IP_WIDTH - SCREEN_BEZEL_THICKNESS * 2,
            IP_HEIGHT - SCREEN_BEZEL_THICKNESS * 2
        );
        const iphoneScreen = new THREE.Mesh(screenGeometry, screenMaterial);

        // Размещаем экран с небольшим смещением вперед (на поверхности корпуса)
        iphoneScreen.position.z = IP_DEPTH / 2 + 0.001;
        iphoneScreen.position.y = 0;

        // 3. Передняя панель (стекло + рамки)
        const glassMaterial = new THREE.MeshPhysicalMaterial({
            color: 0x000000,
            metalness: 0.0,
            roughness: 0.0,
            transmission: 0.95, // Почти прозрачное стекло
            thickness: 0.1, // Толщина для реалистичного преломления
            clearcoat: 1.0,
            clearcoatRoughness: 0.0
        });

        const frontGlassGeometry = new THREE.BoxGeometry(IP_WIDTH, IP_HEIGHT, 0.01);
        const iphoneGlass = new THREE.Mesh(frontGlassGeometry, glassMaterial);
        iphoneGlass.position.z = IP_DEPTH / 2 + 0.005;

        // 4. Блок камер (по концепту iPhone 17 Pro Max - массивный горизонтальный блок)
        const cameraBlockMaterial = new THREE.MeshStandardMaterial({ color: 0x111111, metalness: 0.8, roughness: 0.2 });
        const CAM_BLOCK_HEIGHT = 0.5;
        const CAM_BLOCK_DEPTH = IP_DEPTH / 2 + 0.02; // Выступает
        const camBlockGeometry = new THREE.BoxGeometry(IP_WIDTH, CAM_BLOCK_HEIGHT, CAM_BLOCK_DEPTH);

        const camBlock = new THREE.Mesh(camBlockGeometry, cameraBlockMaterial);
        camBlock.position.y = IP_HEIGHT / 2 - CAM_BLOCK_HEIGHT / 2;
        camBlock.position.z = -IP_DEPTH / 2 - CAM_BLOCK_DEPTH / 2 + 0.005; // Сзади
        camBlock.castShadow = true;

        // 5. Линзы камер (три основные линзы)
        const lensMaterial = new THREE.MeshStandardMaterial({ color: 0x0a0a0a, metalness: 1.0, roughness: 0.0 });
        const lensGeometry = new THREE.CylinderGeometry(0.12, 0.12, 0.03, 16);

        // Создаем группу для всего iPhone
        const iphoneGroup = new THREE.Group();
        iphoneGroup.add(iphoneBody, iphoneScreen, iphoneGlass, camBlock);

        // Расположение линз на блоке камеры
        const lensZ = camBlock.position.z + camBlock.geometry.parameters.depth / 2 + 0.005;
        const lensY = camBlock.position.y;
        
        // Линза 1 (слева)
        const lens1 = new THREE.Mesh(lensGeometry, lensMaterial);
        lens1.rotation.x = Math.PI / 2;
        lens1.position.set(-0.4, lensY, lensZ);
        iphoneGroup.add(lens1);

        // Линза 2 (центр)
        const lens2 = new THREE.Mesh(lensGeometry, lensMaterial);
        lens2.rotation.x = Math.PI / 2;
        lens2.position.set(0, lensY, lensZ);
        iphoneGroup.add(lens2);

        // Линза 3 (справа)
        const lens3 = new THREE.Mesh(lensGeometry, lensMaterial);
        lens3.rotation.x = Math.PI / 2;
        lens3.position.set(0.4, lensY, lensZ);
        iphoneGroup.add(lens3);

        // Добавляем всю группу iPhone на сцену
        iphoneGroup.rotation.y = Math.PI / 6; // Начальный поворот для лучшего обзора
        scene.add(iphoneGroup);


        // --- Поверхность (Пол) ---
        const planeGeometry = new THREE.PlaneGeometry(10, 10);
        const planeMaterial = new THREE.MeshStandardMaterial({ color: 0xcccccc });
        const plane = new THREE.Mesh(planeGeometry, planeMaterial);
        plane.rotation.x = -Math.PI / 2;
        plane.position.y = -IP_HEIGHT / 2; // Устанавливаем пол под моделью
        plane.receiveShadow = true;
        scene.add(plane);


        // --- Управление камерой (OrbitControls) ---
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.target.set(0, 0, 0);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.minDistance = 3;
        controls.maxDistance = 10;
        controls.update();

        // --- Цикл анимации ---
        function animate() {
            requestAnimationFrame(animate);

            controls.update();

            renderer.render(scene, camera);
        }

        animate();

        // Обработчик изменения размера окна
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }, false);
    </script>
</body>
</html>
